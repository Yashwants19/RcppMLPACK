CXX_STD = CXX11

MLPACKOBJECTS=\
./mlpack/core/util/cli.o \
./mlpack/bindings/cli/print_help.o \
./mlpack/bindings/tests/clean_memory.o \
./mlpack/core/util/backtrace.o \
./mlpack/core/util/log.o \
./mlpack/core/util/prefixedoutstream.o \
./mlpack/core/util/program_doc.o \
./mlpack/core/util/singletons.o \
./mlpack/core/util/timers.o \
./mlpack/core/util/version.o \


PKGOBJECTS = RcppExports.o test_r_binding.o r_util.o

PKG_CPPFLAGS= -DBOOST_MATH_PROMOTE_DOUBLE_POLICY=false -I. 
PKG_LIBS= $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)

all: $(SHLIB) userLibrary 

## we place it inside the inst/ directory so that it gets installed by the package
USERDIR =	../inst/lib

MLPACKLIB =	libmlpack$(DYLIB_EXT)
MLPACKLIBST =	libmlpack.a
USERLIB	=	libRcppMLPACK$(DYLIB_EXT)
USERLIBST =	libRcppMLPACK.a

userLibrary: 	$(MLPACKLIB) $(MLPACKLIBST) $(USERLIB) $(USERLIBST)
		-@if test ! -e $(USERDIR)$(R_ARCH); then mkdir -p $(USERDIR)$(R_ARCH); fi
		cp $(MLPACKLIB) $(USERDIR)$(R_ARCH)
		cp $(MLPACKLIBST) $(USERDIR)$(R_ARCH)		
		cp $(USERLIB) $(USERDIR)$(R_ARCH)
		cp $(USERLIBST) $(USERDIR)$(R_ARCH)
		rm $(MLPACKLIB) $(MLPACKLIBST) $(USERLIB) $(USERLIBST)

$(MLPACKLIB): 	$(MLPACKOBJECTS)
		$(SHLIB_CXXLD) -o $(MLPACKLIB) $(MLPACKOBJECTS) $(SHLIB_CXXLDFLAGS) $(ALL_LIBS)
		@if test -e "/usr/bin/install_name_tool"; then /usr/bin/install_name_tool -id $(R_PACKAGE_DIR)/lib$(R_ARCH)/$(MLPACKLIB) $(MLPACKLIB); fi

$(MLPACKLIBST): $(MLPACKOBJECTS)
		$(AR) qc $(MLPACKLIBST) $(MLPACKOBJECTS)
		@if test -n "$(RANLIB)"; then $(RANLIB) $(MLPACKLIBST); fi

$(USERLIB): 	$(PKGOBJECTS)
		$(SHLIB_CXXLD) -o $(USERLIB) $(PKGOBJECTS) $(SHLIB_CXXLDFLAGS) $(MLPACKLIB) $(ALL_LIBS)
		@if test -e "/usr/bin/install_name_tool"; then /usr/bin/install_name_tool -id $(R_PACKAGE_DIR)/lib$(R_ARCH)/$(USERLIB) $(USERLIB); fi

$(USERLIBST): 	$(PKGOBJECTS)
		$(AR) qc $(USERLIBST) $(PKGOBJECTS)
		@if test -n "$(RANLIB)"; then $(RANLIB) $(USERLIBST); fi

.PHONY: 	all clean userLibrary 

clean:
		rm -f $(MLPACKOBJECTS) $(PKGOBJECTS) $(SHLIB) $(MLPACKLIB) $(MLPACKLIBST) $(USERLIB) $(USERLIBST)
